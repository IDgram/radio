<html><head><base href="https://websim.agi"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Radio Épurée avec Liste des Stations Interactives</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background-color: #000;
        color: #fff;
    }
    .container {
        max-width: 580px;
        margin: 0 auto;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: calc(100vh - 100px);
        padding: 20px;
        box-sizing: border-box;
        background-color: #000;
        padding-bottom: 120px; /* Increase bottom padding to account for floating tab bar */
    }
    @media (max-width: 580px) {
        .container {
            max-width: 100%;
            padding-bottom: 120px;
        }
    }
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
    }
    .logo {
        width: 30px;
        height: 30px;
        object-fit: contain;
    }
    .live-indicator {
        background-color: #ff0000;
        color: #ffffff;
        padding: 5px 10px;
        border-radius: 15px;
        font-weight: bold;
        font-size: 14px;
    }
    .station-info {
        text-align: center;
        margin-top: 20px;
        align-items: center;
        display: flex;
        flex-direction: column;
    }
    .station-name {
        font-size: 30px;
        font-weight: bold;
        color: #fff;
    }
    .frequency {
        font-size: 72px;
        font-weight: bold;
        margin-top: 10px;
    }
    .tuner {
        position: relative;
        width: 100%;
        height: 300px;
        margin-top: 40px;
    }
    .dial {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    .dial-marks {
        position: absolute;
        width: 200%;
        height: 100%;
        left: -50%;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        padding-bottom: 60px;
    }
    .mark {
        width: 2px;
        background-color: #333;
        height: 30px;
    }
    .mark.long {
        height: 60px;
    }
    .mark-label {
        position: absolute;
        bottom: 20px;
        font-size: 14px;
        color: #666;
        transform: translateX(-50%);
    }
    .center-line {
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: #f00;
    }
    .knob {
        position: absolute;
        left: 50%;
        bottom: 40px;
        width: 30px;
        height: 30px;
        background: #fff;
        border-radius: 50%;
        transform: translateX(-50%);
        cursor: pointer;
    }
    .controls {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 40px;
        width: 100%;
    }
    .control-btn {
        background: none;
        border: none;
        color: #fff;
        cursor: pointer;
        padding: 15px;
        border-radius: 50%;
        transition: background-color 0.3s ease;
    }
    .control-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }
    .control-btn svg {
        width: 32px;
        height: 32px;
        display: block;
    }
    .stack-icon {
        width: 24px;
        height: 24px;
        cursor: pointer;
        object-fit: contain;
    }
    .station-list {
        padding: 20px 20px 120px 20px;
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 580px;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        display: none;
        flex-direction: column;
        overflow-y: auto;
        box-sizing: border-box;
    }
    @media (max-width: 580px) {
        .station-list {
            left: 0;
            transform: none;
        }
    }
    .station-list-container {
        perspective: 1000px;
        height: 100%;
        overflow-y: auto;
    }
    .station-list-inner {
        transform-style: preserve-3d;
        transform: rotateX(20deg) translateZ(0);
    }
    .station-item {
        background-color: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        margin-bottom: 10px;
        padding: 20px;
        display: grid;
        grid-template-columns: auto 1fr auto auto;
        gap: 15px;
        align-items: center;
        border-radius: 15px;
        cursor: pointer;
        height: 80px;
        position: relative;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        transform: translateZ(0);
    }
    .station-item:hover {
        transform: translateZ(30px) scale(1.05);
        box-shadow: 0 10px 20px rgba(255, 255, 255, 0.2);
    }
    .station-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }
    .station-name {
        font-size: 30px;
        font-weight: bold;
        color: #fff;
        margin-bottom: 5px;
    }
    .station-freq {
        font-size: 24px;
        font-weight: bold;
        color: #fff;
    }
    .station-country {
        font-size: 14px;
        color: #ccc;
    }
    .station-genre {
        font-size: 14px;
        color: #ccc;
    }
    .play-button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.2);
        border: none;
        color: #fff;
        font-size: 18px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .play-button:hover {
        background-color: rgba(255, 255, 255, 0.3);
    }
    .active-station {
        background-color: rgba(255, 255, 255, 0.3);
    }
    .close-list {
        align-self: flex-end;
        background: none;
        border: none;
        color: #fff;
        font-size: 24px;
        cursor: pointer;
        margin-bottom: 20px;
    }
    .tab-bar {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 580px;
        height: 80px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 0 15px;
    }
    @media (max-width: 580px) {
        .tab-bar {
            bottom: 0;
            border-radius: 0;
            border-left: none;
            border-right: none;
            border-bottom: none;
        }
    }
    .station-logo {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
    .volume-control {
        position: fixed;
        bottom: 120px; /* Adjust to position above the floating tab bar */
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        display: flex;
        align-items: center;
        padding: 0 10px;
    }
    .volume-slider {
        width: 100%;
        -webkit-appearance: none;
        background: rgba(255, 255, 255, 0.2);
        outline: none;
        border-radius: 15px;
        overflow: hidden;
    }
    .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #fff;
        cursor: pointer;
        box-shadow: -100vw 0 0 100vw rgba(255, 255, 255, 0.4);
    }
    .save-btn, .save-station-btn {
        background: none;
        border: none;
        color: #fff;
        cursor: pointer;
        padding: 5px;
        transition: color 0.3s ease;
    }
    .save-btn:hover, .save-station-btn:hover {
        color: #ff0000;
    }
    .save-station-btn {
        position: static;
        margin-left: 10px;
    }
    .save-station-btn svg {
        width: 32px;
        height: 32px;
    }
    .save-station-btn.saved svg path {
        fill: yellow;
    }
    .saved-stations-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
    }
    .saved-station-card {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
    }
    .saved-station-card img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-bottom: 10px;
    }
    .saved-station-card .station-name {
        font-weight: bold;
        margin-bottom: 5px;
    }
    .saved-station-card .station-freq {
        font-size: 14px;
        color: #ccc;
    }
    .popup {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }
    .popup-content {
        background-color: #000;
        color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
    }
    #close-popup {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    #close-popup:hover,
    #close-popup:focus {
        color: #fff;
        text-decoration: none;
        cursor: pointer;
    }
</style>
<script src="google-sheets-api.js" defer></script>
</head>
<body>
<div class="container">
    <div class="header">
        <img src="/path/to/logo.png" alt="Radio Logo" class="logo">
        <div class="live-indicator">
            <span>En direct</span>
        </div>
    </div>
    <div class="station-info">
        <div class="station-name" id="current-station-name">KQED-FM</div>
        <div class="frequency" id="frequency-display">88.5</div>
    </div>
    <div class="tuner">
        <div class="dial">
            <div class="dial-marks" id="dial-marks"></div>
            <div class="center-line"></div>
        </div>
        <div class="knob" id="tuner-knob"></div>
    </div>
</div>

<div class="tab-bar">
    <button class="control-btn" id="volume-btn">
        <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
    </button>
    <img src="/path/to/default-logo.png" alt="Station Logo" class="station-logo" id="current-station-logo">
    <button class="control-btn" id="prev-btn">
        <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
    </button>
    <button class="control-btn" id="play-pause-btn">
        <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M8 5v14l11-7z"/>
        </svg>
    </button>
    <button class="control-btn" id="next-btn">
        <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
        </svg>
    </button>
    <button class="control-btn" id="radio-btn">
        <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M20 6H8.3l8.26-3.34L15.88 1 3.24 6.15C2.51 6.43 2 7.17 2 8v12c0 1.1.89 2 2 2h16c1.11 0 2-.9 2-2V8c0-1.11-.89-2-2-2zm0 2v3h-2V9h-2v2H4V8h16zM4 20v-7h16v7H4zm4-5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5z"/>
        </svg>
    </button>
    <button class="control-btn" id="saved-stations-btn">
        <svg viewBox="0 0 24 24" width="32" height="32">
            <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
            <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
        </svg>
    </button>
</div>

<div class="station-list" id="station-list">
    <button class="close-list" id="close-list">✕</button>
    <div class="station-list-container">
        <div class="station-list-inner">
            <div class="station-item" data-freq="102.9" data-name="KBLX">
                <img src="/path/to/kblx-logo.png" alt="KBLX Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KBLX</span>
                    <span class="station-freq">102.9</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
            <div class="station-item" data-freq="103.7" data-name="KKSF">
                <img src="/path/to/kksf-logo.png" alt="KKSF Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KKSF</span>
                    <span class="station-freq">103.7</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
            <div class="station-item" data-freq="105.3" data-name="KITS">
                <img src="/path/to/kits-logo.png" alt="KITS Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KITS</span>
                    <span class="station-freq">105.3</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
            <div class="station-item" data-freq="106.1" data-name="KMEL">
                <img src="/path/to/kmel-logo.png" alt="KMEL Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KMEL</span>
                    <span class="station-freq">106.1</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
            <div class="station-item" data-freq="106.9" data-name="KFRC">
                <img src="/path/to/kfrc-logo.png" alt="KFRC Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KFRC</span>
                    <span class="station-freq">106.9</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
            <div class="station-item" data-freq="88.5" data-name="KQED-FM">
                <img src="/path/to/kqed-fm-logo.png" alt="KQED-FM Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KQED-FM</span>
                    <span class="station-freq">88.5</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
            <div class="station-item" data-freq="99.7" data-name="KMVQ-FM">
                <img src="/path/to/kmvq-fm-logo.png" alt="KMVQ-FM Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KMVQ-FM</span>
                    <span class="station-freq">99.7</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
            <div class="station-item" data-freq="101.3" data-name="KIOI">
                <img src="/path/to/kioi-logo.png" alt="KIOI Logo" class="station-logo">
                <div class="station-info">
                    <span class="station-name">KIOI</span>
                    <span class="station-freq">101.3</span>
                    <span class="station-country"></span>
                    <span class="station-genre"></span>
                </div>
                <button class="play-button">▶</button>
                <button class="save-station-btn">
                    <svg viewBox="0 0 24 24" width="32" height="32">
                        <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                        <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                    </svg>
                </button>
                <audio src=""></audio>
            </div>
        </div>
    </div>
</div>

<div id="saved-stations-popup" class="popup">
    <div class="popup-content">
        <h2>Saved Stations</h2>
        <div id="saved-stations-list" class="saved-stations-grid"></div>
        <button id="close-popup">Close</button>
    </div>
</div>

<script>
    const SHEET_ID = 'YOUR_SHEET_ID_HERE';
    const API_KEY = 'YOUR_API_KEY_HERE';
    const RANGE = 'A2:E';

    async function fetchStations() {
        try {
            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            if (!data || !data.values) {
                throw new Error('No data received from Google Sheets API');
            }
            return data.values.map(row => ({
                name: row[0] || '',
                country: row[1] || '',
                genre: row[2] || '',
                frequency: row[3] || '',
                streamUrl: row[4] || ''
            }));
        } catch (error) {
            console.error('Error fetching stations:', error);
            return [];
        }
    }

    async function updateStationList() {
        try {
            const stations = await fetchStations();
            if (stations.length === 0) {
                console.warn('No stations data available');
                return;
            }
            const stationListInner = document.querySelector('.station-list-inner');
            stationListInner.innerHTML = '';

            stations.forEach(station => {
                const stationItem = document.createElement('div');
                stationItem.className = 'station-item';
                stationItem.dataset.freq = station.frequency;
                stationItem.dataset.name = station.name;

                stationItem.innerHTML = `
                    <img src="/path/to/${station.name.toLowerCase().replace(/\s+/g, '-')}-logo.png" alt="${station.name} Logo" class="station-logo">
                    <div class="station-info">
                        <span class="station-name">${station.name}</span>
                        <span class="station-freq">${station.frequency}</span>
                        <span class="station-country">${station.country}</span>
                        <span class="station-genre">${station.genre}</span>
                    </div>
                    <button class="play-button">▶</button>
                    <button class="save-station-btn">
                        <svg viewBox="0 0 24 24" width="32" height="32">
                            <path class="outline" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                            <path class="filled" fill="currentColor" d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z" style="display: none;"/>
                        </svg>
                    </button>
                    <audio src="${station.streamUrl}"></audio>
                `;

                stationListInner.appendChild(stationItem);
            });

            initializeStationItems();
            updateSaveButtonsAppearance();
        } catch (error) {
            console.error('Error updating station list:', error);
        }
    }

    setInterval(updateStationList, 5 * 60 * 1000);
    updateStationList();

    const knob = document.getElementById('tuner-knob');
    const frequencyDisplay = document.getElementById('frequency-display');
    const currentStationName = document.getElementById('current-station-name');
    const dialMarks = document.getElementById('dial-marks');
    const stationList = document.getElementById('station-list');
    const closeList = document.getElementById('close-list');
    const volumeBtn = document.getElementById('volume-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const currentStationLogo = document.getElementById('current-station-logo');
    const radioBtn = document.getElementById('radio-btn');
    const savedStationsBtn = document.getElementById('saved-stations-btn');
    const saveStationBtns = document.querySelectorAll('.save-station-btn');
    const savedStationsPopup = document.getElementById('saved-stations-popup');
    const savedStationsList = document.getElementById('saved-stations-list');
    const closePopupBtn = document.getElementById('close-popup');

    let isDragging = false;
    let startX, startFreq;
    let volumeControl = null;
    const minFreq = 87;
    const maxFreq = 108;
    let savedStations = JSON.parse(localStorage.getItem('savedStations')) || [];

    function createDialMarks() {
        dialMarks.innerHTML = '';
        for (let i = minFreq; i <= maxFreq; i++) {
            for (let j = 0; j < 10; j++) {
                const mark = document.createElement('div');
                mark.className = 'mark';
                if (j === 0) {
                    mark.className += ' long';
                    const label = document.createElement('span');
                    label.className = 'mark-label';
                    label.textContent = i;
                    mark.appendChild(label);
                }
                dialMarks.appendChild(mark);
            }
        }
    }

    function initializeStationItems() {
        const stationItems = document.querySelectorAll('.station-item');
        stationItems.forEach(item => {
            item.addEventListener('click', () => {
                const freq = parseFloat(item.dataset.freq);
                setFrequency(freq.toFixed(1));
                const dialRect = knob.parentElement.getBoundingClientRect();
                const percent = (freq - minFreq) / (maxFreq - minFreq);
                const newLeft = percent * dialRect.width + dialRect.left;
                updateFrequency(newLeft);
                stationList.style.display = 'none';

                const audio = item.querySelector('audio');
                audio.play();
            });

            const saveBtn = item.querySelector('.save-station-btn');
            saveBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const station = {
                    name: item.dataset.name,
                    freq: item.dataset.freq
                };
                toggleSaveStation(station);
            });
        });
    }

    function updateFrequency(clientX) {
        const knobRect = knob.getBoundingClientRect();
        const dialRect = knob.parentElement.getBoundingClientRect();
        const percent = (clientX - dialRect.left) / dialRect.width;
        const newFreq = minFreq + percent * (maxFreq - minFreq);
        
        setFrequency(newFreq.toFixed(1));
        
        const newLeft = Math.max(0, Math.min(percent * 100, 100));
        dialMarks.style.transform = `translateX(${50 - newLeft}%)`;
    }

    function setFrequency(freq) {
        frequencyDisplay.textContent = freq;
        updateActiveStation(freq);
    }

    function updateActiveStation(freq) {
        let foundStation = false;
        const stationItems = document.querySelectorAll('.station-item');
        stationItems.forEach(item => {
            const itemFreq = parseFloat(item.dataset.freq);
            if (Math.abs(itemFreq - freq) < 0.1) {
                item.classList.add('active-station');
                currentStationName.textContent = item.dataset.name;
                const logo = item.querySelector('.station-logo');
                currentStationLogo.src = logo ? logo.src : '/path/to/default-logo.png';
                foundStation = true;

                const allAudio = document.querySelectorAll('audio');
                allAudio.forEach(audio => audio.pause());
                const currentAudio = item.querySelector('audio');
                currentAudio.play();
            } else {
                item.classList.remove('active-station');
            }
        });
        if (!foundStation) {
            currentStationName.textContent = frequencyDisplay.textContent + " MHz";
            currentStationLogo.src = '/path/to/default-logo.png';
            const allAudio = document.querySelectorAll('audio');
            allAudio.forEach(audio => audio.pause());
        }
    }

    function toggleSaveStation(station) {
        const index = savedStations.findIndex(s => s.freq === station.freq);
        if (index === -1) {
            savedStations.push(station);
        } else {
            savedStations.splice(index, 1);
        }
        updateSavedStations();
        updateSaveButtonsAppearance();
    }

    function updateSavedStations() {
        localStorage.setItem('savedStations', JSON.stringify(savedStations));
    }

    function updateSaveButtonsAppearance() {
        saveStationBtns.forEach(btn => {
            const stationItem = btn.closest('.station-item');
            const isSaved = savedStations.some(s => s.freq === stationItem.dataset.freq);
            btn.classList.toggle('saved', isSaved);
        });
    }

    savedStationsBtn.addEventListener('click', () => {
        showSavedStationsPopup();
    });

    function showSavedStationsPopup() {
        savedStationsList.innerHTML = '';
        savedStations.forEach(station => {
            const card = document.createElement('div');
            card.className = 'saved-station-card';
            card.innerHTML = `
                <img src="/path/to/${station.name.toLowerCase()}-logo.png" alt="${station.name} Logo">
                <span class="station-name">${station.name}</span>
                <span class="station-freq">${station.freq} MHz</span>
            `;
            card.addEventListener('click', () => {
                setFrequency(parseFloat(station.freq).toFixed(1));
                const dialRect = knob.parentElement.getBoundingClientRect();
                const percent = (parseFloat(station.freq) - minFreq) / (maxFreq - minFreq);
                const newLeft = percent * dialRect.width + dialRect.left;
                updateFrequency(newLeft);
                savedStationsPopup.style.display = 'none';
            });
            savedStationsList.appendChild(card);
        });
        savedStationsPopup.style.display = 'block';
    }

    closePopupBtn.addEventListener('click', () => {
        savedStationsPopup.style.display = 'none';
    });

    knob.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        startFreq = parseFloat(frequencyDisplay.textContent);
        e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
        if (isDragging) {
            updateFrequency(e.clientX);
        }
    });

    document.addEventListener('mouseup', () => {
        isDragging = false;
    });

    knob.addEventListener('touchstart', (e) => {
        isDragging = true;
        startX = e.touches[0].clientX;
        startFreq = parseFloat(frequencyDisplay.textContent);
        e.preventDefault();
    });

    document.addEventListener('touchmove', (e) => {
        if (isDragging) {
            updateFrequency(e.touches[0].clientX);
        }
    });

    document.addEventListener('touchend', () => {
        isDragging = false;
    });

    radioBtn.addEventListener('click', () => {
        if (stationList.style.display === 'none' || stationList.style.display === '') {
            stationList.style.display = 'flex';
            setTimeout(updateScrollEffect, 0);
        } else {
            stationList.style.display = 'none';
        }
    });

    closeList.addEventListener('click', () => {
        stationList.style.display = 'none';
    });

    function updateScrollEffect() {
        const container = document.querySelector('.station-list-container');
        const inner = document.querySelector('.station-list-inner');
        const scrollPercentage = container.scrollTop / (container.scrollHeight - container.clientHeight);
        
        inner.style.transform = `rotateX(${20 - scrollPercentage * 40}deg) translateZ(0)`;
        
        const items = document.querySelectorAll('.station-item');
        items.forEach((item, index) => {
            const itemTop = item.offsetTop;
            const itemHeight = item.offsetHeight;
            const itemCenter = itemTop + itemHeight / 2;
            const containerCenter = container.scrollTop + container.clientHeight / 2;
            const distance = Math.abs(itemCenter - containerCenter);
            const scale = Math.max(0.8, 1 - distance / 1000);
            
            item.style.transform = `scale(${scale}) translateZ(${distance / 10}px)`;
        });
    }

    document.querySelector('.station-list-container').addEventListener('scroll', updateScrollEffect);

    createDialMarks();
    updateFrequency(window.innerWidth / 2);

    const playPauseBtn = document.getElementById('play-pause-btn');
    let isPlaying = false;

    playPauseBtn.addEventListener('click', () => {
        isPlaying = !isPlaying;
        if (isPlaying) {
            playPauseBtn.innerHTML = '<svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        } else {
            playPauseBtn.innerHTML = '<svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>';
        }
    });

    volumeBtn.addEventListener('click', () => {
        if (volumeControl) {
            document.body.removeChild(volumeControl);
            volumeControl = null;
        } else {
            volumeControl = document.createElement('div');
            volumeControl.className = 'volume-control';
            volumeControl.innerHTML = `
                <input type="range" min="0" max="100" value="50" class="volume-slider">
            `;
            document.body.appendChild(volumeControl);
            
            const volumeSlider = volumeControl.querySelector('.volume-slider');
            volumeSlider.addEventListener('input', (e) => {
                const volume = e.target.value / 100;
                console.log(`Volume set to ${volume}`);
            });
        }
    });

    function changeStation(direction) {
        const currentFreq = parseFloat(frequencyDisplay.textContent);
        let nearestStation = null;
        let minDiff = Infinity;

        const stationItems = document.querySelectorAll('.station-item');
        stationItems.forEach(item => {
            const itemFreq = parseFloat(item.dataset.freq);
            const diff = direction === 'next' ? itemFreq - currentFreq : currentFreq - itemFreq;
            if (diff > 0 && diff < minDiff) {
                minDiff = diff;
                nearestStation = item;
            }
        });

        if (nearestStation) {
            const newFreq = parseFloat(nearestStation.dataset.freq);
            setFrequency(newFreq.toFixed(1));
            const dialRect = knob.parentElement.getBoundingClientRect();
            const percent = (newFreq - minFreq) / (maxFreq - minFreq);
            const newLeft = percent * dialRect.width + dialRect.left;
            updateFrequency(newLeft);
        }
    }

    prevBtn.addEventListener('click', () => changeStation('prev'));
    nextBtn.addEventListener('click', () => changeStation('next'));

    createDialMarks();
    updateFrequency(window.innerWidth / 2);
    updateSaveButtonsAppearance();
</script>
<script src="google-sheets-api.js"></script> <!-- Insertion du fichier JavaScript ici -->
</body></html>